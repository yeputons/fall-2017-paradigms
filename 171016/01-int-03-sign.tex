\subsection{Знаковые числа}

\begin{frame}
	\tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}
	\begin{itemize}
		\item
			Можно сказать, что в первом бите храним знак, а в остальных "--- число, как раньше (\textit{прямой код}).
		\item
			Тогда надо разбирать случаи в процессоре для всех арифметических и логических операций.
		\item
			Появляются $+0$ и $-0$, так что ещё и сравнение на равенство сильно менять.
	\end{itemize}

	А можно сказать, что, $-x$ по определению "--- это такое $y$, что $x+y=0$.

	Тогда вспоминаем, что мы уже живём по модулю 256 (проверьте вычисления в Python самостоятельно!):
	\begin{align*}
		x &= x + 256 &\mod 256 \\
		-56 &= -56 + 256 = 200 &\mod 256 \\
		-56 + 56 &= -56 + 256 + 56 = 256 = 0 &\mod 256 \\
		-17 \cdot 22 &= -374 = 138 &\mod 256 \\
		-17 \cdot 22 &= (256 - 17) \cdot 22 = 239 \cdot 22 = 5258 = 138 &\mod 256
	\end{align*}
\end{frame}

\begin{frame}
	\begin{center}
		\includegraphics[scale=0.3]{one-ring-to-rule.jpg}
	\end{center}
\end{frame}

\begin{frame}
	Алгебра говорит, что $-x$ "--- это \textit{обратный по сложению к $x$}.
	В кольцах он есть.
	Считаем, что обратный по сложению к $x$ в кольце $\mathbb{Z}/256\mathbb{Z}$ и есть элемент $-x$.

	Мы только поменяли, как мы интерпретируем числа, но не их битовую запись:
	\begin{gather*}
		\mod 256 \\
		-56 + 100 = -56 + 256 + 100 = 200 + 100 = \\
		= \t{1100~1000} + \t{0110~0100} = \t{1~0010~1100} = \t{0010~1100} = 44
	\end{gather*}
	Таким образом, сложение, вычитание, и даже умножение по-прежнему работают (спасибо алгебраистам, что доказали).

	Упражнение: проверить, что:
	\[ a = b \mod 256 \rightarrow a \cdot x = b \cdot x \mod 256\]

	С делением хуже:
	\[
		-10 / 5 = (256 - 10) / 5 = 246 / 5 = 49.5 = \t{???}
	\]
\end{frame}

\begin{frame}{Дополнительный код}
	\begin{enumerate}
		\item Мы можем как угодно обозначить элементы кольца: какие-то назвать отрицательными числами, а какие-то "--- положительными.
		\item Обычно разделяют отрезок ровно пополам: $[-128; 127]$.
		\item Теперь по самому старшему биту можно определить знак: 1 "--- отрицательное, 0 "--- неотрицательное.
	\end{enumerate}

	Такая конвенция называется \textit{дополнительный код}: отрицательное и положительно число в сумме дают нули или
	дополняют до степени двойки $2^8$.

	\begin{enumerate}
		\item
			Надо разбирать случаи в сравнении чисел и в делении с остатком (поэтому они в ассемблере появляются знаковые/беззнаковые).
		\item
			Есть операция смены знака: инвертировать все биты и добавить единицу (инвертация бит "--- это вычитание из $\t{1111~1111}_2=255_{10}$).
	\end{enumerate}
\end{frame}

\begin{frame}{Упражнение}
	Как представлены следующие числа в дополнительном коде?

	\begin{center}
		\pause
		\begin{tabular}{|c|c|}
			\hline
			-1 & \pause \t{1111 1111} \\\hline\noalign{\pause}
			-128 & \pause \t{1000 0000} \\\hline\noalign{\pause}
			127 & \pause \t{0111 1111} \\\hline\noalign{\pause}
			128 & \pause никак \\
			\hline
		\end{tabular}
		\pause
	\end{center}
	Что будет, если мы возьмём $-(-128)$? \pause
	\begin{gather*}
		-128=\t{1000~0000} \\
		-(-128)=(\tilde{}\t{1000~0000})+1 = \t{0111~1111}+1 = \t{1000~0000} = 128 \\
	\end{gather*}
\end{frame}
